<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Agent</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f9fc;
      color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    h1 {
      color: #0066cc;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #0066cc;
      color: white;
      font-size: 16px;
    }
    #transcript {
      width: 80%;
      max-width: 600px;
      height: 250px;
      margin-top: 20px;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¤ Live Speech-to-Text</h1>
  <button id="startBtn">Start Recording</button>
  <button id="stopBtn">Stop Recording</button>
  <div id="transcript"></div>

  <script>
    let ws, mediaRecorder;

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const transcriptBox = document.getElementById("transcript");

    startBtn.onclick = async () => {
      ws = new WebSocket(`ws://${window.location.host}/ws`);
      ws.onmessage = (event) => {
        transcriptBox.textContent += event.data + " ";
        transcriptBox.scrollTop = transcriptBox.scrollHeight;
      };

      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream, { mimeType: "audio/webm" });

      mediaRecorder.ondataavailable = async (event) => {
        if (event.data.size > 0 && ws.readyState === WebSocket.OPEN) {
          const arrayBuffer = await event.data.arrayBuffer();
          ws.send(arrayBuffer);
        }
      };

      mediaRecorder.start(250);
    };

    stopBtn.onclick = () => {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
      }
      if (ws) {
        ws.close();
      }
    };
  </script>
</body>
</html>
